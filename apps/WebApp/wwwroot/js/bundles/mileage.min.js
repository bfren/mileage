function showAlert(n,t,i){(message.find(".icon").html(alertIcons[n]),message.find(".text").text(t),message.find(".countdown").text(""),message.show(),clearTimeout(alertTimeout),n=="error"||i)||updateAlert(5)}function showPleaseWaitAlert(){showAlert("info","Please wait...",!0)}function updateAlert(n){if(n==0){closeAlert();return}message.find(".countdown").text(n);alertTimeout=setTimeout(()=>updateAlert(n-1),1e3)}function closeAlert(){message.fadeOut()}function showAlertsOnLoad(){}function setupTokenModals(){$("body").on("click",".token > a",function(){var n=$(this).data("edit"),t=$(this).data("replace");openModal(n,t)})}function openModal(n,t){showPleaseWaitAlert();console.log("Loading modal from: "+n);$("#edit").load(n,function(){var r=$(this).find("form");r.attr("data-replace",t);var i=$(this),u=$(this).find(".modal").attr("id"),n=document.getElementById(u);n.addEventListener("shown.bs.modal",()=>$(".modal-select").focus());n.addEventListener("hide.bs.modal",()=>i.fadeOut("fast"));i.fadeIn("fast",()=>closeAlert());modal=new bootstrap.Modal(n);modal.show();setupModalSearch()})}function setupModalSearch(){var n=$("#edit .btn-add");n.hide();$("#list-filter").keydown(function(t){t.keyCode==13&&(t.preventDefault(),n.click())});$("#list-filter").keyup(function(){var t=$(this).val();t?n.text("Add: "+t).show():n.text("").hide();$("#list-items .list-item").filter(function(){var n=$(this).data("text").indexOf(t.toLowerCase())>-1;$(this).toggle(n)})})}function setupModalSave(){$("body").on("click","#edit .btn-save",function(){$("#edit form").submit();modal.hide()})}function handleResult(n){showAlert(n.message.type,n.message.text);n.redirectTo&&(showAlert("info","Redirecting...",!0),window.location.href=n.redirectTo)}function setupSettingsTabs(){$("#settingsButtons .nav-link").click(function(){var n=$(this).data("bs-target");loadSettingsTab(n)})}function loadSettingsTab(n){var t=$(n),i=t.data("src");showPleaseWaitAlert();t.load(i,()=>closeAlert())}function loadSaveForm(n,t,i){i.preventDefault();var r=t.data("load");showPleaseWaitAlert();$("#save-"+n).load(r,()=>closeAlert())}function setupAjaxSubmit(){$("body").on("submit","form",function(n){n.preventDefault();showPleaseWaitAlert();var t=$(this),i=t.data("replace");$.ajax({url:t.attr("action"),method:"POST",data:t.serialize()}).done(function(n){if(i){if(n){$("#"+i).replaceWith(n);showAlert("success","Saved.");setupTokenModals();return}showAlert("error","Unable to save, please try again.");return}n&&handleResult(n)}).fail(function(n){if(n&&n.responseJSON){handleResult(n.responseJSON);return}showAlert("error","Something went wrong, please try again.")})})}var alertTimeout,modal;const alertIcons={close:$("<i/>").addClass("fa-solid fa-xmark"),info:$("<i/>").addClass("fa-solid fa-circle-info"),success:$("<i/>").addClass("fa-solid fa-check"),warning:$("<i/>").addClass("fa-solid fa-triangle-exclamation"),error:$("<i/>").addClass("fa-solid fa-ban"),edit:$("<i/>").addClass("fa-solid fa-circle-plus"),"delete":$("<i/>").addClass("fa-solid fa-circle-minus"),complete:$("<i/>").addClass("fa-solid fa-circle-check"),save:$("<i/>").addClass("fa-solid fa-ban")},message=$(".statusbar .message");alertTimeout=0;ready(()=>message.click(()=>closeAlert()));ready(showAlertsOnLoad);ready(setupTokenModals);ready(setupModalSave);ready(setupSettingsTabs);ready(setupAjaxSubmit);