function showAlert(n,t,i){(message.find(".icon").html(alertIcons[n]),message.find(".text").text(t),message.find(".countdown").text(""),message.show(),clearTimeout(alertTimeout),n==alertTypes.error||i)||updateAlert(5)}function showPleaseWaitAlert(){showAlert(alertTypes.info,"Please wait...",!0)}function updateAlert(n){if(n==0){closeAlert();return}message.find(".countdown").text(n);alertTimeout=setTimeout(()=>updateAlert(n-1),1e3)}function closeAlert(){message.fadeOut()}function showAlertsOnLoad(){}function setupDatepickerDefaults(){$.fn.datepicker.defaults.autoclose=!0;$.fn.datepicker.defaults.todayBtn="linked";$.fn.datepicker.defaults.format="yyyy-mm-dd"}function openModal(n,t,i,r,u){showPleaseWaitAlert();$(n).load(t,function(){var t=$(this).find("form");i&&(t.attr("data-replace",i),t.attr("data-replace-contents",r));var f=$(this),e=$(this).find(".modal").attr("id"),n=document.getElementById(e);n.addEventListener("shown.bs.modal",()=>{var n=$(".modal-select");n.length==1?n.select():n.first().select()});n.addEventListener("hide.bs.modal",()=>f.fadeOut("fast"));f.fadeIn("fast",()=>closeAlert());modal=new bootstrap.Modal(n);modal.show();u&&u()})}function openCreateModal(n){openModal("#create",n,null,!0,()=>{setupCreateModalSearch(),setupCreateModalUnknown()})}function setupCreateModalSearch(){$("#create .list-filter").keydown(function(n){n.keyCode==13&&n.preventDefault()});$("#create .list-filter").keyup(function(){var n=$(this).val(),t=$(this).data("filter-for");$("#"+t+" label").filter(function(){var t=$(this).data("text").indexOf(n.toLowerCase())>-1;$(this).toggle(t)})})}function setupCreateModalUnknown(){$(".unknown-toggle").on("change",function(){if($(this).is(":checked"))$(".unknown").val("").attr("disabled",!0).blur();else{var n=$(".unknown-value").val();$(".unknown").val(n).removeAttr("disabled").select()}})}function setupCreateModalOpen(){$("body").on("click",".btn-create",function(n){n.preventDefault();var t=$(this).data("create");openCreateModal(t)})}function setupCreateModalSave(){$("body").on("click","#create .btn-save",function(){$("#create form").submit()})}function openDeleteModal(n,t){openModal("#delete",n,t,!0)}function setupDeleteModalOpen(){$("body").on("click",".btn-delete-check",function(n){checkDeleteItem($(this),n)})}function setupDeleteModalSave(){$("body").on("click","#delete .btn-delete",function(){$("#delete form").submit();modal.hide()})}function checkDeleteItem(n,t){t.preventDefault();var i=n.data("delete"),r=n.data("replace");openDeleteModal(i,r)}function openUpdateModal(n,t){openModal("#update",n,t,!1,()=>setupUpdateModalSearch())}function setupUpdateModalSearch(){var n=$("#update .btn-add");n.hide();$("#update .list-filter").keydown(function(t){t.keyCode==13&&(t.preventDefault(),n.click())});$("#update .list-filter").keyup(function(){var t=$(this).val(),i;t?n.text("Add: "+t).show():n.text("").hide();i=$(this).data("filter-for");$("#"+i+" label").filter(function(){var n=$(this).data("text").indexOf(t.toLowerCase())>-1;$(this).toggle(n)})})}function setupUpdateModalSave(){var n=function(n){n.preventDefault();$("#update form").submit()};$("body").on("click","#update .btn-save",t=>n(t));$("body").on("change","#update .auto-save",t=>n(t));$("body").on("keypress","#update input",function(t){t.keyCode==13&&n(t)})}function setupTokenUpdateModals(){$("body").on("click",".token > a, .btn-complete",function(){var n=$(this).data("update"),t=$(this).data("replace");openUpdateModal(n,t)})}function handleResult(n){showAlert(n.message.type,n.message.text);n.redirectTo&&(showAlert(alertTypes.info,"Redirecting...",!0),window.location.href=n.redirectTo)}function setupSettingsTabs(){$("#settingsButtons .nav-link").click(function(){var n=$(this).data("bs-target");loadSettingsTab(n)})}function loadSettingsTab(n){var t=$(n),i;t.html($("<div/>").text("Loading..."));showPleaseWaitAlert();i=t.data("src");t.load(i,()=>closeAlert())}function loadSaveForm(n,t,i){var r,u;(i.preventDefault(),r="btn-delete-check",$(i.target).hasClass(r)||$(i.target).parents("."+r).length>0)||(u=t.data("load"),showPleaseWaitAlert(),$("#save-"+n).load(u,()=>closeAlert()))}function setupReloadFormOnCancel(n,t,i){$(n).on("click",".btn-cancel",function(n){loadSaveForm(t,i,n)})}function setupSaveFormOnEnter(n){$(n).on("keydown","input",function(t){t.keyCode==13&&(t.preventDefault(),$(n).find(".btn-save").click())})}function selectInputOnLoad(){$(".select-on-load").select()}function setupAjaxSubmit(){$("body").on("submit","form",function(n){n.preventDefault();var t=$(this),i=t.data("replace"),r=t.data("replace-contents");if(this.checkValidity()===!1){t.find(":input:visible").not("[formnovalidate]").parent().addClass("was-validated");return}modal&&modal.hide();showPleaseWaitAlert();$.ajax({url:t.attr("action"),method:"POST",data:t.serialize()}).done(function(n,t,u){if(u.responseJSON){handleResult(u.responseJSON);return}if(n&&i){var f=$("#"+i);r?f.html(n):f.replaceWith(n);showAlert(alertTypes.success,"Done.");return}showAlert(alertTypes.warning,"Something went wrong, refreshing the page...",!0);location.reload()}).fail(function(n){if(n&&n.responseJSON){handleResult(n.responseJSON);return}showAlert(alertTypes.error,"Something went wrong, please try again.")})})}var alertTimeout,modal;const alertIcons={close:$("<i/>").addClass("fa-solid fa-xmark"),info:$("<i/>").addClass("fa-solid fa-circle-info"),success:$("<i/>").addClass("fa-solid fa-check"),warning:$("<i/>").addClass("fa-solid fa-triangle-exclamation"),error:$("<i/>").addClass("fa-solid fa-ban"),update:$("<i/>").addClass("fa-solid fa-circle-plus"),"delete":$("<i/>").addClass("fa-solid fa-circle-minus"),complete:$("<i/>").addClass("fa-solid fa-circle-check"),save:$("<i/>").addClass("fa-solid fa-ban")},alertTypes={info:"info",success:"success",warning:"warning",error:"error"},message=$(".statusbar .message");alertTimeout=0;ready(()=>message.click(()=>closeAlert()));ready(showAlertsOnLoad);ready(setupDatepickerDefaults);ready(setupCreateModalOpen);ready(setupCreateModalSave);ready(setupDeleteModalOpen);ready(setupDeleteModalSave);ready(setupUpdateModalSave);ready(setupTokenUpdateModals);ready(setupSettingsTabs);ready(setupAjaxSubmit);