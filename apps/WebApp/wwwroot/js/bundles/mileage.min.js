function isAlert(){return message.is(":visible")}function isAlertSticky(){return isAlert()&&message.data("sticky")}function showAlert(n,t,i){if(n!=alertTypes.info||!isAlertSticky()){if(message.find(".icon").html(alertIcons[n]),message.find(".text").text(t),message.find(".countdown").text(""),message.data("type",n),message.data("sticky",i?"true":"false"),message.stop().show(),clearTimeout(alertTimeout),n==alertTypes.error||i){message.find(".close").show();return}message.find(".close").hide();updateAlert(alertCountdown)}}function showPleaseWaitAlert(){showAlert(alertTypes.info,"Please wait...",!0)}function updateAlert(n){if(n==0){closeAlert(!0);return}message.find(".countdown").text(n);alertTimeout=setTimeout(()=>updateAlert(n-1),1e3)}function closeAlert(n){(n||message.data("type")==alertTypes.info)&&message.fadeOut()}function setupDatepickerDefaults(){$.fn.datepicker.defaults.autoclose=!0;$.fn.datepicker.defaults.todayBtn="linked";$.fn.datepicker.defaults.format="yyyy-mm-dd"}function loadPage(n){getHash()==n?loadHash():window.location.hash=n}function loadHash(){showAlert(alertTypes.info,"Loading page, please wait...",!0);var n=getHash();n&&n.length!=2||(n=home);$.ajax({url:n,method:"GET"}).done(function(n,t,i){if(closeAlert(),i.responseJSON){handleResult(i.responseJSON);return}$("#content").html(n);window.scrollTo(0,0)}).fail(function(n){if(closeAlert(),n.status==401){$("#content").load(signIn);return}if(n&&n.responseJSON){handleResult(n.responseJSON);return}showAlert(alertTypes.error,"Something went wrong, please try again.")})}function getHash(){return window.location.hash.replace("#","")}function setupLinks(){$("body").on("click","a",function(n){var t=$(this).attr("href");t.startsWith("http")||t!="javascript:void(0)"&&(n.preventDefault(),loadPage(t))})}function openModal(n,t,i,r,u){showPleaseWaitAlert();$(n).load(t,function(n,t,f){var e;f.status==401&&showAlert(alertTypes.error,"You are not authorised to do this, please sign in.");e=$(this).find("form");i&&(e.attr("data-replace",i),e.attr("data-replace-contents",r));var s=$(this),h=$(this).find(".modal").attr("id"),o=document.getElementById(h);o.addEventListener("shown.bs.modal",()=>{var t=$(".modal-select"),n;t.length==1?t.select():t.first().select();n=$(".modal-focus");n.length==1?n.focus():n.first().focus()});o.addEventListener("hide.bs.modal",()=>s.fadeOut("fast"));s.fadeIn("fast",()=>closeAlert());$("body").on("click",n=>{$(n.target).is(".modal")&&modal.hide()});modal=new bootstrap.Modal(o);modal.show();u&&u()})}function filterModalItems(n,t){$("#"+n+" .with-data").filter(function(){var n=$(this).data("text").toString().toLowerCase(),i=t.toLowerCase(),r=n.indexOf(i)>-1;return $(this).toggle(r),n==i})}function openCreateModal(n){openModal("#create",n,null,!0,()=>{setupCreateModalSearch(),setupCreateModalUnknown()})}function setupCreateModalSearch(){$("#create .list-filter").keydown(function(n){n.keyCode==13&&n.preventDefault()});$("#create .list-filter").keyup(function(){var n=$(this).val().toString(),t=$(this).data("filter-for");filterModalItems(t,n)})}function setupCreateModalUnknown(){$(".unknown-toggle").on("change",function(){if($(this).is(":checked"))$(".unknown").val("").attr("disabled",!0).blur();else{var n=$(".unknown-value").val();$(".unknown").val(n).removeAttr("disabled").select()}})}function setupCreateModalOpen(){$("body").on("click",".btn-create",function(n){n.preventDefault();var t=$(this).data("create");openCreateModal(t)})}function setupCreateModalSave(){$("body").on("click","#create .btn-save",function(){$("#create form").submit()})}function openDeleteModal(n,t){openModal("#delete",n,t,!0)}function setupDeleteModalOpen(){$("body").on("click",".btn-delete-check",function(n){checkDeleteItem($(this),n)})}function setupDeleteModalSave(){$("body").on("click","#delete .btn-delete",function(){$("#delete form").submit();modal.hide()})}function checkDeleteItem(n,t){t.preventDefault();var i=n.data("delete"),r=n.data("replace");openDeleteModal(i,r)}function setupChangePasswordUpdateModal(){$("body").on("click",".change-password",function(n){n.preventDefault();var t=$(this).data("change");openUpdateModal(t,null)})}function openUpdateModal(n,t,i){openModal("#update",n,t,i,()=>setupUpdateModalSearch())}function setupUpdateModalOpen(){$("body").on("click",".btn-update",function(n){n.preventDefault();var t=$(this).data("update"),i=$(this).data("replace"),r=$(this).data("replace-contents");openUpdateModal(t,i,r)})}function setupUpdateModalSearch(){var n=$("#update .btn-add");n.hide();n.not(":disabled")&&n.click(addNewItemToJourney);$("#update .list-filter").keydown(function(t){t.keyCode==13&&(t.preventDefault(),n.not(":disabled")&&n.click())});$("#update .list-filter").keyup(function(){var t=$(this).val().toString(),i=$(this).data("filter-for"),r=filterModalItems(i,t);n.is(":disabled")||(t&&!r?n.text("Add: "+t).show():n.text("").hide())})}function setupUpdateModalSave(){var n=function(n){n.preventDefault();$("#update form").submit()};$("body").on("click","#update .btn-save",t=>n(t));$("body").on("change","#update .auto-save",t=>n(t));$("body").on("keypress","#update input",function(t){t.keyCode==13&&n(t)})}function setupTokenUpdateModals(){$("body").on("click",".token > a, .btn-complete",function(){var n=$(this).data("update"),t=$(this).data("replace");openUpdateModal(n,t,!1)})}function addNewItemToJourney(){var n={id:$("#Journey_Id").val(),version:$("#Journey_Version").val(),value:$("#update .list-filter").val(),__requestVerificationToken:$("#update [name=__RequestVerificationToken]").val()},t=$(this).data("url");submitForm($("#update form"),t,n)}function closeNavWhenClicked(){$(".navbar-nav .nav-item a").click(function(){$(".navbar-toggler:visible").click()})}function handleResult(n){var t=n.message.type==alertTypes.warning||n.message.type==alertTypes.error;showAlert(n.message.type,n.message.text,t);n.redirectTo&&(n.redirectTo=="/"?loadPage(home):n.redirectTo=="refresh"?loadHash():loadPage(n.redirectTo))}function setupSettingsTabs(){$("body").on("click","#settingsButtons .nav-link",function(){var n=$(this).data("bs-target");loadSettingsTab(n)})}function loadSettingsTab(n){var t=$(n),i;t.html($("<div/>").text("Loading..."));showPleaseWaitAlert();i=t.data("src");t.load(i,()=>closeAlert())}function loadSaveForm(n,t,i){var r,u;(i.preventDefault(),r="btn-delete-check",$(i.target).hasClass(r)||$(i.target).parents("."+r).length>0)||(u=t.data("load"),showPleaseWaitAlert(),$("#save-"+n).load(u,()=>closeAlert()))}function setupSaveFormOnEnter(n){$(n).on("keydown","input",function(t){t.keyCode==13&&(t.preventDefault(),$(n).find(".btn-save").click())})}function selectInputOnLoad(){$(".select-on-load").select()}function setupAjaxSubmit(){$("body").on("submit","form",function(n){n.preventDefault();var t=$(this);if(this.checkValidity()===!1){t.find(":input:visible").not("[formnovalidate]").parent().addClass("was-validated");return}submitForm(t)})}function submitForm(n,t,i){var u=n.attr("method"),r=n.data("replace"),f=n.data("replace-contents");modal&&modal.hide();showPleaseWaitAlert();$.ajax({method:u??"POST",url:t||n.attr("action"),data:i||n.serialize()}).done(function(n,t,i){if(i.responseJSON){handleResult(i.responseJSON);return}if(n&&r){var u=$("#"+r);f?u.html(n):u.replaceWith(n);showAlert(alertTypes.success,"Done.");return}showAlert(alertTypes.warning,"Something went wrong, refreshing the page.",!0);loadHash()}).fail(function(n){if(n&&n.responseJSON){handleResult(n.responseJSON);return}showAlert(alertTypes.error,"Something went wrong, please try again.")})}var alertTimeout,modal;const alertIcons={close:$("<i/>").addClass("fa-solid fa-xmark"),info:$("<i/>").addClass("fa-solid fa-circle-info"),success:$("<i/>").addClass("fa-solid fa-check"),warning:$("<i/>").addClass("fa-solid fa-triangle-exclamation"),error:$("<i/>").addClass("fa-solid fa-ban"),update:$("<i/>").addClass("fa-solid fa-circle-plus"),"delete":$("<i/>").addClass("fa-solid fa-circle-minus"),complete:$("<i/>").addClass("fa-solid fa-circle-check"),save:$("<i/>").addClass("fa-solid fa-ban")},alertTypes={info:"info",success:"success",warning:"warning",error:"error"},message=$(".statusbar .message"),alertCountdown=3;alertTimeout=0;ready(()=>message.click(()=>closeAlert(!0)));ready(setupDatepickerDefaults);ready(loadHash);window.onhashchange=loadHash;ready(setupLinks);ready(setupCreateModalOpen);ready(setupCreateModalSave);ready(setupDeleteModalOpen);ready(setupDeleteModalSave);ready(setupChangePasswordUpdateModal);ready(setupUpdateModalOpen);ready(setupUpdateModalSave);ready(setupTokenUpdateModals);ready(closeNavWhenClicked);ready(setupSettingsTabs);ready(setupAjaxSubmit);