@page
@using Mileage.Persistence.Common.StrongIds
@model Mileage.WebApp.Pages.Settings.Places.IndexModel
@{
	Layout = null;
	string? editLink(PlaceId? placeId) =>
		Url.Page(pageName: "Index", pageHandler: "FormPartial", values: new { placeId = placeId?.Value });

	string? deleteLink(PlaceId placeId) =>
		Url.Page(pageName: "Index", pageHandler: "DeletePartial", values: new { placeId = placeId.Value });
}

<div id="save-place" class="mt-3 mb-3" data-load="@editLink(null)">
	@await Html.PartialAsync("_Form", model: null, ViewData)
</div>

<ul id="place-list" class="list-group w-100">
	@foreach (var p in Model.Places)
	{
		var description = p.Description;
		if (p.Postcode is string postcode)
		{
			description += $" ({postcode})";
		}

		<li class="list-group-item" data-id="@p.Id.Value" data-load="@editLink(p.Id)">
			<div class="d-flex justify-content-between align-items-start">
				<div class="mb-1 mb-sm-0 me-3 fw-bold col-1">@p.Id.Value</div>
				<div class="me-auto mb-1 mb-sm-0">@description</div>
				<button type="button" class="btn btn-danger btn-delete" data-delete="@deleteLink(p.Id)" data-replace="places"><i class="fa-solid fa-circle-minus"></i></button>
			</div>
		</li>
	}
</ul>

<script type="text/javascript">
	selectInputOnLoad();
	$("#place-list .list-group-item").click(function(e) { loadSaveForm("place", $(this), e); });
	$("#place-list .btn-delete").click(function(e) { checkDeleteItem($(this), e); });
</script>
